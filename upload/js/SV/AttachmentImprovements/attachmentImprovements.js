!function(t,e,a,n){XenForo.BbCodeWysiwygEditor.prototype.getImageModal;XenForo.BbCodeWysiwygEditor.prototype.getImageModal=function(e){var n=this.dialogUrl,o=t("input#ctrl_uploader").data("href");if(o&&this.dialogUrl){var i=o.indexOf("?");n=n+"&"+o.substring(i+1)}a.newAttachments=void 0!==a.newAttachments?a.newAttachments:[],e.saveSelection();var r,l=e.getSelectedHtml();l.match(/^\s*<img[^>]+src="([^"]+)"[^>]*>\s*$/)&&!l.match(/mceSmilie|attachFull|attachThumb/)&&(r=RegExp.$1,r=t("<textarea>").html(r).text()),e.modalInit(this.getText("image"),{url:n+"&dialog=image"},600,t.proxy(function(){var n=t("#redactor_image_link");t("#redactor_image_btn").click(function(t){t.preventDefault(),e.restoreSelection();var a=n.val();""!==a&&(a.match(/^https?:|ftp:/i)||(a="http://"+a),e.pasteHtmlAtCaret('<img src="'+XenForo.htmlspecialchars(a)+'" alt="[IMG]" unselectable="on" />&nbsp;')),e.modalClose(),e.observeImages(),e.syncCode(),e.focus()}),r&&n.val(r),setTimeout(function(){n.focus()},100);var o=t("form form#hiddenAttachmentForm");if(o.parent().closest("form.xenForm").siblings("form").remove(),o.insertAfter(o.parent().closest("form.xenForm")),t("form#hiddenAttachmentForm").parent().xfActivate(),DialogAttachmentInserter=function(a){var n=t("img",this),o=t("form#hiddenAttachmentForm"),i=o.find("input[name='attachmentIdNormalizer']").val(),r={_xfToken:o.find("input[name='_xfToken']").val(),attachmentID:n.data("attachmentid"),key:o.find("input[name='key']").val(),hash:o.find("input[name='hash']").val(),content_type:o.find("input[name='content_type']").val()};i?XenForo.ajax(XenForo.canonicalizeUrl(i),r,function(t){"url"in t&&(e.pasteHtmlAtCaret('<img src="'+t.url+'" class="attachFull bbCodeImage" alt="attachFull'+t.id+'" /> '),e.modalClose(),e.observeImages(),e.syncCode(),e.focus())}):console.log("No target URL found.")},t(".singleAttachment").click(DialogAttachmentInserter),t("input:file.uploadFileInputOutside").change(function(e){t("form#hiddenAttachmentForm input:file").remove();var a=t("input:file.uploadFileInputOutside").clone(!0);a.wrap("<form>").closest("form").get(0).reset(),a.unwrap(),t("input:file.uploadFileInputOutside").replaceWith(a).appendTo(t("form#hiddenAttachmentForm")).removeClass("uploadFileInputOutside").unbind("change"),XenForo.AutoInlineUploader(t("form#hiddenAttachmentForm")),t("form#hiddenAttachmentForm input:file").trigger("change")}),t("#redactor_modal #hiddenAttachmentForm").bind("AutoInlineUploadComplete",function(e){var n=t("a._not_LbTrigger",e.ajaxData.templateHtml).data("attachmentid"),o=t("img",e.ajaxData.templateHtml).clone().attr("data-attachmentid",n).wrap('<div class="Thumbnail singleAttachment">').before('<span class="centeringHelper"></span>').parent().prependTo("#redactor_modal div.attachmentContainer").click(DialogAttachmentInserter);a.newAttachments.push(o)}),t(".moreAttachments").click(function(e){var a=t("img",this),n=t("form#hiddenAttachmentForm"),o=n.find("input[name='attachmentFetcher']").val(),i={_xfToken:n.find("input[name='_xfToken']").val(),attachmentID:a.data("attachmentid"),key:n.find("input[name='key']").val(),hash:n.find("input[name='hash']").val(),content_type:n.find("input[name='content_type']").val(),existing:t(".moreAttachments").first().siblings().length};t("input[name^='content_data']",n).each(function(e,a){i[t(a).attr("name")]=t(a).val()}),o?XenForo.ajax(XenForo.canonicalizeUrl(o),i,function(a){var n=t("#redactor_modal");if("fixed"==n.css("position")){var o=n.offset();n.css({position:"absolute",top:o.top,left:o.left,"margin-left":"0px","margin-top":"0px"})}t(a.templateHtml).xfInsert("insertBefore",e.target).click(DialogAttachmentInserter),t("span#loaded_all").length&&e.target.remove()}):console.log("No target URL found.")}),a.newAttachments.length){var i=t("#redactor_modal div.attachmentContainer");t.each(a.newAttachments,function(t,e){e.prependTo(i).click(DialogAttachmentInserter)})}},e))}}(jQuery,0,document);