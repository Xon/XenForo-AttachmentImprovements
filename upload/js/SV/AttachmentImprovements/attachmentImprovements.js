!function(t,e,n,a){XenForo.BbCodeWysiwygEditor.prototype.getImageModal;XenForo.BbCodeWysiwygEditor.prototype.getImageModal=function(e){var a=this.dialogUrl,o=t("input#ctrl_uploader").data("href");if(o&&this.dialogUrl){var i=o.indexOf("?");a=a+"&"+o.substring(i+1)}n.newAttachments=void 0!==n.newAttachments?n.newAttachments:[],e.saveSelection();var r,l=e.getSelectedHtml();l.match(/^\s*<img[^>]+src="([^"]+)"[^>]*>\s*$/)&&!l.match(/mceSmilie|attachFull|attachThumb/)&&(r=RegExp.$1,r=t("<textarea>").html(r).text()),e.modalInit(this.getText("image"),{url:a+"&dialog=image"},600,t.proxy(function(){var a=t("#redactor_image_link");t("#redactor_image_btn").click(function(t){t.preventDefault(),e.restoreSelection();var n=a.val();""!==n&&(n.match(/^https?:|ftp:/i)||(n="http://"+n),e.pasteHtmlAtCaret('<img src="'+XenForo.htmlspecialchars(n)+'" alt="[IMG]" unselectable="on" />&nbsp;')),e.modalClose(),e.observeImages(),e.syncCode(),e.focus()}),r&&a.val(r),setTimeout(function(){a.focus()},100);var o=t("form form#hiddenAttachmentForm");if(o.parent().closest("form.xenForm").siblings("form").remove(),o.insertAfter(o.parent().closest("form.xenForm")),t("form#hiddenAttachmentForm").parent().xfActivate(),DialogAttachmentInserter=function(n){var a=t("img",this),o=t("form#hiddenAttachmentForm"),i=o.find("input[name='attachmentIdNormalizer']").val(),r={_xfToken:o.find("input[name='_xfToken']").val(),attachmentID:a.data("attachmentid"),key:o.find("input[name='key']").val(),hash:o.find("input[name='hash']").val(),content_type:o.find("input[name='content_type']").val()};i?XenForo.ajax(XenForo.canonicalizeUrl(i),r,function(t){"url"in t&&(e.pasteHtmlAtCaret('<img src="'+t.url+'" class="attachFull bbCodeImage" alt="attachFull'+t.id+'" /> '),e.modalClose(),e.observeImages(),e.syncCode(),e.focus())}):console.log("No target URL found.")},t(".singleAttachment").click(DialogAttachmentInserter),t("input:file.uploadFileInputOutside").change(function(e){t("form#hiddenAttachmentForm input:file").remove();var n=t("input:file.uploadFileInputOutside").clone(!0);n.wrap("<form>").closest("form").get(0).reset(),n.unwrap(),t("input:file.uploadFileInputOutside").replaceWith(n).appendTo(t("form#hiddenAttachmentForm")).removeClass("uploadFileInputOutside").unbind("change"),XenForo.AutoInlineUploader(t("form#hiddenAttachmentForm")),t("form#hiddenAttachmentForm input:file").trigger("change")}),t("#redactor_modal #hiddenAttachmentForm").bind("AutoInlineUploadComplete",function(e){var a=t("a._not_LbTrigger",e.ajaxData.templateHtml).data("attachmentid"),o=t("img",e.ajaxData.templateHtml).clone().attr("data-attachmentid",a).wrap('<div class="Thumbnail singleAttachment">').before('<span class="centeringHelper"></span>').parent().prependTo("#redactor_modal div.attachmentContainer").click(DialogAttachmentInserter);n.newAttachments.push(o)}),t(".moreAttachments").click(function(e){var n=t("img",this),a=t("form#hiddenAttachmentForm"),o=a.find("input[name='attachmentFetcher']").val(),i={_xfToken:a.find("input[name='_xfToken']").val(),attachmentID:n.data("attachmentid"),key:a.find("input[name='key']").val(),hash:a.find("input[name='hash']").val(),content_type:a.find("input[name='content_type']").val(),existing:t(".moreAttachments").first().siblings().length};t("input[name^='content_data']",a).each(function(e,n){i[t(n).attr("name")]=t(n).val()}),o?XenForo.ajax(XenForo.canonicalizeUrl(o),i,function(n){t(n.templateHtml).xfInsert("insertBefore",e.target).click(DialogAttachmentInserter),t("span#loaded_all").length&&e.target.remove()}):console.log("No target URL found.")}),n.newAttachments.length){var i=t("#redactor_modal div.attachmentContainer");t.each(n.newAttachments,function(t,e){e.prependTo(i).click(DialogAttachmentInserter)})}},e))}}(jQuery,0,document);