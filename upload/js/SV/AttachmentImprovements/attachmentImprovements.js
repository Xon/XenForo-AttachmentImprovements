!function(t,e,a,n){XenForo.BbCodeWysiwygEditor.prototype.getImageModal;XenForo.BbCodeWysiwygEditor.prototype.getImageModal=function(e){var a=this.dialogUrl,n=t("input#ctrl_uploader").data("href");if(n&&this.dialogUrl){var o=n.indexOf("?");a=a+"&"+n.substring(o+1)}e.saveSelection();var i,r=e.getSelectedHtml();r.match(/^\s*<img[^>]+src="([^"]+)"[^>]*>\s*$/)&&!r.match(/mceSmilie|attachFull|attachThumb/)&&(i=RegExp.$1,i=t("<textarea>").html(i).text()),e.modalInit(this.getText("image"),{url:a+"&dialog=image"},600,t.proxy(function(){var a=t("#redactor_image_link");t("#redactor_image_btn").click(function(t){t.preventDefault(),e.restoreSelection();var n=a.val();""!==n&&(n.match(/^https?:|ftp:/i)||(n="http://"+n),e.pasteHtmlAtCaret('<img src="'+XenForo.htmlspecialchars(n)+'" alt="[IMG]" unselectable="on" />&nbsp;')),e.modalClose(),e.observeImages(),e.syncCode(),e.focus()}),i&&a.val(i),setTimeout(function(){a.focus()},100);var n=t("form form#hiddenAttachmentForm");n.parent().closest("form.xenForm").siblings("form").remove(),n.insertAfter(n.parent().closest("form.xenForm")),t("form#hiddenAttachmentForm").parent().xfActivate(),DialogAttachmentInserter=function(a){var n,o;n=t("img",this),o=t("form#hiddenAttachmentForm");var i={attachmentID:n.data("attachmentid"),key:o.find("input[name='key']").val(),hash:o.find("input[name='hash']").val(),contentType:o.find("input[name='content_type']").val()};console.log(o.find("input[name='attachmentIdNormalizer']").val()),XenForo.ajax(XenForo.canonicalizeUrl(o.find("input[name='attachmentIdNormalizer']").val()),i,function(t){e.pasteHtmlAtCaret('<img src="'+n.data("src")+'" class="attachFull bbCodeImage" alt="attachFull'+t.newID+'" /> '),e.modalClose(),e.observeImages(),e.syncCode(),e.focus()})},t("input:file.uploadFileInputOutside").change(function(e){t("form#hiddenAttachmentForm input:file").remove();var a=t("input:file.uploadFileInputOutside").clone(!0);a.wrap("<form>").closest("form").get(0).reset(),a.unwrap(),t("input:file.uploadFileInputOutside").replaceWith(a).appendTo(t("form#hiddenAttachmentForm")).removeClass("uploadFileInputOutside").unbind("change"),XenForo.AutoInlineUploader(t("form#hiddenAttachmentForm")),t("form#hiddenAttachmentForm input:file").trigger("change")}),t(".singleAttachment").click(DialogAttachmentInserter),t("#redactor_modal #hiddenAttachmentForm").bind("AutoInlineUploadComplete",function(e){id=t("a._not_LbTrigger",e.ajaxData.templateHtml).data("attachmentid"),t("img",e.ajaxData.templateHtml).clone().attr("data-attachmentid",id).wrap('<div class="Thumbnail singleAttachment">').before('<span class="centeringHelper"></span>').parent().prependTo("div.attachmentContainer").click(DialogAttachmentInserter)})},e))}}(jQuery,0,document);